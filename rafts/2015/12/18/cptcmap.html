<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using color palette tables as Matlab colormaps</title>
  <meta name="description" content="I’ll begin my series of Matlab code posts with one of the functions that I use most often in my own work: cptcmap.m.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://kellyakearney.net/2015/12/18/cptcmap">
  <link rel="alternate" type="application/rss+xml" title="Kelly A. Kearney" href="http://kellyakearney.net/feed.xml" />
<link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.2.4' type='text/css' media='all' />
<link href='http://fonts.googleapis.com/css?family=Titillium+Web:600italic,600,400,400italic' rel='stylesheet' type='text/css'>

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Kelly A. Kearney</a>


    <nav class="site-nav">

      <a href="#" class="menu-icon menu.open">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>  

    <div class="trigger"><h1>Main Navigation</h1>

 <ul class="menu">

    
    
     <li><a href="/research/" class="page-link">Research</a>
    
    </li>
    
    
     <li><a href="/blog/" class="page-link">Technical Blog</a>
    
    </li>
    
    
     <li><a href="/publications/" class="page-link">Publications</a>
    
    </li>
    
    </ul>


<!-- <ul class="menu">
        <li> <a class="page-link" href="/about">About</a></li>
        <li> <a class="page-link"  href="/blog">Blog</a>
        <li> <a class="page-link" href="/blog">CV</a>
        <li> <a class="page-link" href="/blog">For Students</a></li>
        <li> <a class="page-link"  href="/blog">Research</a></a>
        <li> <a class="page-link" href="/blog">Teaching</a>
<ul class="sub-menu">
	<li><a href="http://svmiller.com/teaching/posc-1020-introduction-to-international-relations/">POSC 1020 – Introduction to International Relations</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3410-quantitative-methods-in-political-science/">POSC 3410 – Quantitative Methods in Political Science</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3610-international-politics-in-crisis/">POSC 3610 – International Politics in Crisis</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3630-united-states-foreign-policy/">POSC 3630 – United States Foreign Policy</a></li>
</ul></li>
        <li> <a class="page-link" href="/blog">Miscellany</a>
<ul class="sub-menu">
	<li><a href="http://svmiller.com/teaching/posc-1020-introduction-to-international-relations/">Clean USAID Greenbook Data</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3410-quantitative-methods-in-political-science/">Journal of Peace Research *.bst File</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3610-international-politics-in-crisis/">My Custom Beamer Style</a></li>
</ul> 

</li>
</ul> -->

     </div>  
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Using color palette tables as Matlab colormaps</h1>
    <p class="post-meta">Posted on December 18, 2015   

  in
  


</p>
  </header>

  <article class="post-content">
    <p>I’ll begin my series of Matlab code posts with one of the functions that I use most often in my own work: <a href="https://github.com/kakearney/cptcmap-pkg">cptcmap.m</a>.</p>

<p><img src="/assets/supporting_code/cptcmapexample.png" onload="this.width/=2;this.onload=null;" /></p>

<p>Matlab comes with a decent selection of colormaps.  I was never a fan of the old <code class="highlighter-rouge">jet</code> colormap (due to all the <a href="http://www.mathworks.com/company/newsletters/articles/rainbow-color-map-critiques-an-overview-and-annotated-bibliography.html">inherent issues</a> with rainbow colormaps), but the new <code class="highlighter-rouge">parula</code> default is a pretty good general purpose color scheme, and there are several two- or three-color gradients that are also serviceable for publication-quality graphics.</p>

<p>But what are your options when you’re looking for something more specific?  What if, like me, you love reading up on color theory and choosing just the right color scheme for each of your plots?  The <code class="highlighter-rouge">colormapeditor</code> function allows you to play around with custom colormaps, but it’s a very manual process.  Particularly when plotting bathymetry and topography data, where I had very specific colors in mind for specific ranges of data, I found myself wishing I could define colormaps more precisely.  Early in my career, I used the Generic Mapping Tools software to plot some maps, and while GMT isn’t nearly as user-friendly as Matlab to create quick plots, it certainly produces some beautiful maps.  The GMT color palette tables show up in a lot of software used by scientists in oceanography and climate science, such as NASA GISS’s Panoply.  And there’s a wonderful assortment of color palette tables available at <a href="http://soliton.vm.bytemark.co.uk/pub/cpt-city/">cpt-city</a>.  Why limit myself to a few Matlab colormaps when there are all these options out there?</p>

<p>So a few years ago, while at sea and repeatedly waiting for a CTD to complete it’s two- to three-hour journey to the seafloor and back, I wrote cptcmap.m to import and use GMT-style color palette tables in Matlab.</p>

<h2 id="the-color-palette-file-format">The color palette file format</h2>

<p>The color palette format consists of a simple plain text file:</p>

<figure class="highlight"><pre><code class="language-none" data-lang="none"># COLOR_MODEL = RGB
z0   R0    G0    B0    z1 R1a G1a B1a [A] [;label]
z1   R1b   G1b   B1b   z2 R2a G2a B2a [A] [;label]
...
zn-1 Rn-1b Gn-1b Bn-1b zn Rn  Gn  Bn [A] [;label] 
B Rb Gb Bb
F Rf Gf Bf
N Rn Gn Bn</code></pre></figure>

<p>Comments in the color palette file are marked by lines starting with a <code class="highlighter-rouge">#</code>.  The only comment that isn’t ignored is a comment line that specifies the color model: RGB, CMYK, or HSV.  The example above shows the RGB format.</p>

<p>The main color definition section of the file has 8 (RGB, HSV) or 10 (CMYK) columns, plus two optional columns.  Each color block is assigned a lower and upper data value (z), and color values to match these bounds.  If the lower and upper colors are the same, then that color is assigned to the full range.  If the colors are different, then a linear gradient between the two colors results.  The optional A flag and semicolon-plus-text column tell GMT how to annotate the color scale.  The <code class="highlighter-rouge">cptcmap</code> function ignores those optional columns.</p>

<p>The lines begining with B, F, and N indicate the colors used to shade background data values (z &lt; z0), foreground data values (z &gt; zn), and NaN data values, repectively.  These three colors aren’t used by <code class="highlighter-rouge">cptcmap</code> when creating a colormap, but they can be returned as optional output values.</p>

<h2 id="converting-color-palettes-to-colormaps">Converting color palettes to colormaps</h2>

<p>The trickiest part of turning a color palette into a colormap is determining the number of colors you need to resolve all the specific color ranges in a given palette.  For example:</p>

<figure class="highlight"><pre><code class="language-none" data-lang="none">0  255 0 0  1  255 0 0
1  0 255 0  3  0 255 0
3  0 0 255  6  0 0 255</code></pre></figure>

<p>This color palette is pretty simple: red from 0-1, green from 1-3, and blue from 3-6. To resolve this in a Matlab colormap, you’ll need a 6-color colormap:</p>

<figure class="highlight"><pre><code class="language-none" data-lang="none">1 0 0
0 1 0
0 1 0
0 0 1
0 0 1
0 0 1</code></pre></figure>

<p>with the <code class="highlighter-rouge">CLim</code> property of your axis set to <code class="highlighter-rouge">[0 6]</code>.</p>

<p>By repeating colors in the colormap, you get the appropriate relative size interval for each visible color.  This is the primary task of <code class="highlighter-rouge">cptcmap</code>; it checks all the color intervals and figures out how many times it needs to repeat colors in order to get all the color breaks in the right place.  Once it’s done that, it interpolates the proper number of colors into the new colormap, and (if the direct mapping option is chosen) changes the axis color limits to match the z-values in the color palette table.</p>

<h2 id="resolution-considerations">Resolution considerations</h2>

<p>Under the automated option, I have the number of colors in the final colormap capped at 256.  This is the maximum number of colors that can be included on some computers (Windows), and will be more than sufficient for most plots.  But you may need to specify a higher number of colors (via the <code class="highlighter-rouge">ncol</code> input) if some of your defined color blocks cover a much smaller range than others.</p>

<p>The GMT_globe color palette (one of the GMT defaults, included with <code class="highlighter-rouge">cptcmap</code>) demonstrates this resolution problem.  I can use the accompanying <code class="highlighter-rouge">cptcbar</code> function to compare the discretized colormap to the “real” color palette (the <code class="highlighter-rouge">cptcbar</code> on the right uses patches to plot the color intervals, so it is able to resolve everything exactly as it is defined in the color palette; the colorbar on the left shows the actual colormap being used in the figure):</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">ax</span> <span class="o">=</span> <span class="nb">axes</span><span class="p">;</span>
<span class="n">cptcmap</span><span class="p">(</span><span class="s1">'GMT_globe'</span><span class="p">,</span> <span class="s1">'mapping'</span><span class="p">,</span> <span class="s1">'direct'</span><span class="p">);</span>
<span class="n">cb1</span> <span class="o">=</span> <span class="nb">colorbar</span><span class="p">(</span><span class="s1">'location'</span><span class="p">,</span> <span class="s1">'west'</span><span class="p">);</span>
<span class="n">cb2</span> <span class="o">=</span> <span class="n">cptcbar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">'GMT_globe'</span><span class="p">,</span> <span class="s1">'east'</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

<span class="nb">set</span><span class="p">([</span><span class="n">cb1</span> <span class="n">cb2</span><span class="o">.</span><span class="n">ax</span><span class="p">],</span> <span class="s1">'ylim'</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1500</span> <span class="mi">1500</span><span class="p">]);</span></code></pre></figure>

<p><img src="/assets/supporting_code/cbar1.png" onload="this.width/=2;this.onload=null;" /><br />
<img src="/assets/supporting_code/cbar2.png" onload="this.width/=2;this.onload=null;" /></p>

<p>With only 256 colors, we aren’t quite resolving the full color detail intended for low-altitude data.  For a global map, this is perfectly acceptable:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="p">[</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">satbath</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="n">worldmap</span><span class="p">(</span><span class="s1">'World'</span><span class="p">);</span>
<span class="n">pcolorm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">z</span><span class="p">);</span>
<span class="n">cptcmap</span><span class="p">(</span><span class="s1">'GMT_globe'</span><span class="p">,</span> <span class="s1">'mapping'</span><span class="p">,</span> <span class="s1">'direct'</span><span class="p">);</span></code></pre></figure>

<p><img src="/assets/supporting_code/cptres1.png" onload="this.width/=2;this.onload=null;" /></p>

<p>But zoom in on Florida, and we’re suddenly missing some important detail:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">h</span> <span class="o">=</span> <span class="n">usamap</span><span class="p">(</span><span class="s1">'Florida'</span><span class="p">);</span>
<span class="p">[</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">satbath</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">getm</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s1">'MapLatLim'</span><span class="p">),</span> <span class="n">getm</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s1">'MapLonLim'</span><span class="p">));</span>
<span class="n">pcolorm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">z</span><span class="p">);</span>
<span class="n">cptcmap</span><span class="p">(</span><span class="s1">'GMT_globe'</span><span class="p">,</span> <span class="s1">'mapping'</span><span class="p">,</span> <span class="s1">'direct'</span><span class="p">);</span></code></pre></figure>

<p><img src="/assets/supporting_code/cptres2.png" onload="this.width/=2;this.onload=null;" /></p>

<p>In this case, we’ll want to up the number of colors to resolve all that fine detail in the gradients close to sea level.</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">cptcmap</span><span class="p">(</span><span class="s1">'GMT_globe'</span><span class="p">,</span> <span class="s1">'mapping'</span><span class="p">,</span> <span class="s1">'direct'</span><span class="p">,</span> <span class="s1">'ncol'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">);</span></code></pre></figure>

<p><img src="/assets/supporting_code/cptres3.png" onload="this.width/=2;this.onload=null;" /></p>

<h2 id="limitations">Limitations</h2>

<p>Right now, the <code class="highlighter-rouge">cptcmap.m</code> function can read in either RGB or HSV color palette tables.  Matlab doesn’t do CMYK-to-RGB conversion natively, and I haven’t actually found any color palette tables that I wanted to use that were defined in CMYK color space, so I simply haven’t gotten around to writing that little conversion yet.</p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

<!--     <h2 class="footer-heading">Kelly A. Kearney</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><strong>Kelly A. Kearney</strong></li>

          <li><a href="mailto:kakearney@gmail.com">kakearney@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/kakearney">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">kakearney</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
         <p class="text">
University of Washington<br> Joint Institute for the Study of the Atmosphere and Ocean<br> Alaska Fisheries Science Center, NOAA<br> 7600 Sand Point Way N.E., Building 4<br> Seattle, Washington 98115
 
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
