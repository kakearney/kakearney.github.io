<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kelly A. Kearney</title>
    <description>University of Washington&lt;br&gt; Joint Institute for the Study of the Atmosphere and Ocean&lt;br&gt; Alaska Fisheries Science Center, NOAA&lt;br&gt; 7600 Sand Point Way N.E., Building 4&lt;br&gt; Seattle, Washington 98115
</description>
    <link>http://kellyakearney.net/</link>
    <atom:link href="http://kellyakearney.net/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 12 Jan 2016 16:16:38 -0800</pubDate>
    <lastBuildDate>Tue, 12 Jan 2016 16:16:38 -0800</lastBuildDate>
    <generator>Jekyll v3.0.1</generator>
    
      <item>
        <title>Using color palette tables as Matlab colormaps</title>
        <description>&lt;p&gt;I’ll begin my series of Matlab code posts with one of the functions that I use most often in my own work: &lt;a href=&quot;https://github.com/kakearney/cptcmap-pkg&quot;&gt;cptcmap.m&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/supporting_code/cptcmapexample.png&quot; onload=&quot;this.width/=2;this.onload=null;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Matlab comes with a decent selection of colormaps.  I was never a fan of the old &lt;code class=&quot;highlighter-rouge&quot;&gt;jet&lt;/code&gt; colormap (due to all the &lt;a href=&quot;http://www.mathworks.com/company/newsletters/articles/rainbow-color-map-critiques-an-overview-and-annotated-bibliography.html&quot;&gt;inherent issues&lt;/a&gt; with rainbow colormaps), but the new &lt;code class=&quot;highlighter-rouge&quot;&gt;parula&lt;/code&gt; default is a pretty good general purpose color scheme, and there are several two- or three-color gradients that are also serviceable for publication-quality graphics.&lt;/p&gt;

&lt;p&gt;But what are your options when you’re looking for something more specific?  What if, like me, you love reading up on color theory and choosing just the right color scheme for each of your plots?  The &lt;code class=&quot;highlighter-rouge&quot;&gt;colormapeditor&lt;/code&gt; function allows you to play around with custom colormaps, but it’s a very manual process.  Particularly when plotting bathymetry and topography data, where I had very specific colors in mind for specific ranges of data, I found myself wishing I could define colormaps more precisely.  Early in my career, I used the Generic Mapping Tools software to plot some maps, and while GMT isn’t nearly as user-friendly as Matlab to create quick plots, it certainly produces some beautiful maps.  The GMT color palette tables show up in a lot of software used by scientists in oceanography and climate science, such as NASA GISS’s Panoply.  And there’s a wonderful assortment of color palette tables available at &lt;a href=&quot;http://soliton.vm.bytemark.co.uk/pub/cpt-city/&quot;&gt;cpt-city&lt;/a&gt;.  Why limit myself to a few Matlab colormaps when there are all these options out there?&lt;/p&gt;

&lt;p&gt;So a few years ago, while at sea and repeatedly waiting for a CTD to complete it’s two- to three-hour journey to the seafloor and back, I wrote cptcmap.m to import and use GMT-style color palette tables in Matlab.&lt;/p&gt;

&lt;h2 id=&quot;the-color-palette-file-format&quot;&gt;The color palette file format&lt;/h2&gt;

&lt;p&gt;The color palette format consists of a simple plain text file:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-none&quot; data-lang=&quot;none&quot;&gt;# COLOR_MODEL = RGB
z0   R0    G0    B0    z1 R1a G1a B1a [A] [;label]
z1   R1b   G1b   B1b   z2 R2a G2a B2a [A] [;label]
...
zn-1 Rn-1b Gn-1b Bn-1b zn Rn  Gn  Bn [A] [;label] 
B Rb Gb Bb
F Rf Gf Bf
N Rn Gn Bn&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Comments in the color palette file are marked by lines starting with a &lt;code class=&quot;highlighter-rouge&quot;&gt;#&lt;/code&gt;.  The only comment that isn’t ignored is a comment line that specifies the color model: RGB, CMYK, or HSV.  The example above shows the RGB format.&lt;/p&gt;

&lt;p&gt;The main color definition section of the file has 8 (RGB, HSV) or 10 (CMYK) columns, plus two optional columns.  Each color block is assigned a lower and upper data value (z), and color values to match these bounds.  If the lower and upper colors are the same, then that color is assigned to the full range.  If the colors are different, then a linear gradient between the two colors results.  The optional A flag and semicolon-plus-text column tell GMT how to annotate the color scale.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcmap&lt;/code&gt; function ignores those optional columns.&lt;/p&gt;

&lt;p&gt;The lines begining with B, F, and N indicate the colors used to shade background data values (z &amp;lt; z0), foreground data values (z &amp;gt; zn), and NaN data values, repectively.  These three colors aren’t used by &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcmap&lt;/code&gt; when creating a colormap, but they can be returned as optional output values.&lt;/p&gt;

&lt;h2 id=&quot;converting-color-palettes-to-colormaps&quot;&gt;Converting color palettes to colormaps&lt;/h2&gt;

&lt;p&gt;The trickiest part of turning a color palette into a colormap is determining the number of colors you need to resolve all the specific color ranges in a given palette.  For example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-none&quot; data-lang=&quot;none&quot;&gt;0  255 0 0  1  255 0 0
1  0 255 0  3  0 255 0
3  0 0 255  6  0 0 255&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This color palette is pretty simple: red from 0-1, green from 1-3, and blue from 3-6. To resolve this in a Matlab colormap, you’ll need a 6-color colormap:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-none&quot; data-lang=&quot;none&quot;&gt;1 0 0
0 1 0
0 1 0
0 0 1
0 0 1
0 0 1&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;with the &lt;code class=&quot;highlighter-rouge&quot;&gt;CLim&lt;/code&gt; property of your axis set to &lt;code class=&quot;highlighter-rouge&quot;&gt;[0 6]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;By repeating colors in the colormap, you get the appropriate relative size interval for each visible color.  This is the primary task of &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcmap&lt;/code&gt;; it checks all the color intervals and figures out how many times it needs to repeat colors in order to get all the color breaks in the right place.  Once it’s done that, it interpolates the proper number of colors into the new colormap, and (if the direct mapping option is chosen) changes the axis color limits to match the z-values in the color palette table.&lt;/p&gt;

&lt;h2 id=&quot;resolution-considerations&quot;&gt;Resolution considerations&lt;/h2&gt;

&lt;p&gt;Under the automated option, I have the number of colors in the final colormap capped at 256.  This is the maximum number of colors that can be included on some computers (Windows), and will be more than sufficient for most plots.  But you may need to specify a higher number of colors (via the &lt;code class=&quot;highlighter-rouge&quot;&gt;ncol&lt;/code&gt; input) if some of your defined color blocks cover a much smaller range than others.&lt;/p&gt;

&lt;p&gt;The GMT_globe color palette (one of the GMT defaults, included with &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcmap&lt;/code&gt;) demonstrates this resolution problem.  I can use the accompanying &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcbar&lt;/code&gt; function to compare the discretized colormap to the “real” color palette (the &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcbar&lt;/code&gt; on the right uses patches to plot the color intervals, so it is able to resolve everything exactly as it is defined in the color palette; the colorbar on the left shows the actual colormap being used in the figure):&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;span class=&quot;n&quot;&gt;ax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;axes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cptcmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;GMT_globe&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;mapping&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;direct&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cb1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;colorbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;location&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;west&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cb2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cptcbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;GMT_globe&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;east&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cb1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cb2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;ylim&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1500&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;/assets/supporting_code/cbar1.png&quot; onload=&quot;this.width/=2;this.onload=null;&quot; /&gt;&lt;br /&gt;
&lt;img src=&quot;/assets/supporting_code/cbar2.png&quot; onload=&quot;this.width/=2;this.onload=null;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With only 256 colors, we aren’t quite resolving the full color detail intended for low-altitude data.  For a global map, this is perfectly acceptable:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;satbath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;worldmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;World&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pcolorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cptcmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;GMT_globe&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;mapping&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;direct&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;/assets/supporting_code/cptres1.png&quot; onload=&quot;this.width/=2;this.onload=null;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But zoom in on Florida, and we’re suddenly missing some important detail:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usamap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Florida&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;satbath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;MapLatLim&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;MapLonLim&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pcolorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cptcmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;GMT_globe&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;mapping&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;direct&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;/assets/supporting_code/cptres2.png&quot; onload=&quot;this.width/=2;this.onload=null;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In this case, we’ll want to up the number of colors to resolve all that fine detail in the gradients close to sea level.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;span class=&quot;n&quot;&gt;cptcmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;GMT_globe&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;mapping&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;direct&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;ncol&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;/assets/supporting_code/cptres3.png&quot; onload=&quot;this.width/=2;this.onload=null;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;limitations&quot;&gt;Limitations&lt;/h2&gt;

&lt;p&gt;Right now, the &lt;code class=&quot;highlighter-rouge&quot;&gt;cptcmap.m&lt;/code&gt; function can read in either RGB or HSV color palette tables.  Matlab doesn’t do CMYK-to-RGB conversion natively, and I haven’t actually found any color palette tables that I wanted to use that were defined in CMYK color space, so I simply haven’t gotten around to writing that little conversion yet.&lt;/p&gt;

</description>
        <pubDate>Fri, 18 Dec 2015 00:00:00 -0800</pubDate>
        <link>http://kellyakearney.net/2015/12/18/cptcmap</link>
        <guid isPermaLink="true">http://kellyakearney.net/2015/12/18/cptcmap</guid>
        
        
      </item>
    
      <item>
        <title>Jekyll migration</title>
        <description>&lt;p&gt;I’ve just migrated my website from WordPress to Jekyll.  Or rather, I’ve created a new Jekyll site and deleted my old WordPress one.  After using WordPress for the past two years, I’ve found that it was a bit bloated for my purposes, requiring too many plugins and updates for a pretty hands-off website.  And when I started attempting to blog recently, I found it overly complicated to try to embed things like javascript-based graphics.  What I really needed was a lightweight platform that would allow me to make small updates to main pages (my publications list, mainly) quickly and easily.  And since I’ve been using Markdown more and more lately, being able to write blog posts using that is a definite plus.  Jekyll coupled with GitHub Pages met these requirements nicely; I was able to create a new site in a few hours, with a few more days spent tweaking the layout to my liking and getting jekyll-scholar running nicely for my publications.&lt;/p&gt;

&lt;p&gt;Many thanks to Steve Miller, whose &lt;a href=&quot;http://svmiller.com/blog/2015/08/create-your-website-in-jekyll/&quot;&gt;blog post&lt;/a&gt; on setting up an academic website proved very helpful (and whose template I stole for this site).  Also, thanks to Eric Tramel, whose &lt;a href=&quot;http://eric-tramel.github.io/working-automated-publications/&quot;&gt;blog post&lt;/a&gt; on automated publication lists I used to set up my own publications page.&lt;/p&gt;

&lt;p&gt;So here we are!  I have plans to begin blogging semi-regularly, primarily to promote and explain some of my publically-available Matlab code.  I’ve also ported over one old blog post that described how I set up and maintain my GitHub repositories.&lt;/p&gt;
</description>
        <pubDate>Fri, 20 Nov 2015 00:00:00 -0800</pubDate>
        <link>http://kellyakearney.net/2015/11/20/jekyll-migration</link>
        <guid isPermaLink="true">http://kellyakearney.net/2015/11/20/jekyll-migration</guid>
        
        
      </item>
    
      <item>
        <title>Using git subtrees to manage files with overlapping dependencies</title>
        <description>&lt;p&gt;This post ended up much longer than I intended, so here’s the short summary: I’m going to explain how (and why) I took a single git repository consisting of a mishmash of Matlab code with lots of overlapping file dependencies, and teased it apart into project- and utility-specific repositories that could be shared with others and easily kept in sync with the main repo as I make updates in the future.&lt;/p&gt;

&lt;p&gt;This is mostly to remind myself what I did. But maybe it can help some others who are facing the same task.&lt;/p&gt;

&lt;h3 id=&quot;the-background&quot;&gt;The background&lt;/h3&gt;

&lt;p&gt;I learned almost everything I know about Matlab (and coding in general) by reading various newsgroups and blogs, especially the &lt;a href=&quot;http://www.mathworks.com/matlabcentral/newsreader/&quot;&gt;Matlab newsgroup&lt;/a&gt; (comp.soft-sys.matlab) and later &lt;a href=&quot;http://www.mathworks.com/matlabcentral/answers/&quot;&gt;Matlab Answers&lt;/a&gt; forum.  In return, I try to post a few of my own functions for download when others inquire on those boards about issues I have tackled.  My past method for doing this was a bit clunky and manual.  I would simply copy the relevant .m files into a new folder, zip, and upload.  I tried to repeat the copy-and-upload process every few months to keep things up to date, but wasn’t very good about tracking what I changed when, and sometimes “every few months” became “every year or two”, and occasionally I overlooked an outside dependency or two when collecting the files together.&lt;/p&gt;

&lt;p&gt;When MatlabCentral started offering integration with GitHub this year, I decided to rethink my method for distributing my code to others.  I had already been using git to manage my own Matlab code for about 3 years at that point, and hoped that adding a few for-distribution repositories would be nice and easy.  That didn’t end up being the case.&lt;/p&gt;

&lt;p&gt;The biggest issue that I encountered in finding a solution involved overlapping file dependencies.  Most git tutorials that I found online related to submodules and subtrees and other methods for sharing code between projects seemed to assume that I was approaching things as a proper computer programmer, with nicely organized code managed by project-specific git repositories.  When it came to overlapping dependencies, the tutorials usually assumed that the shared code involved small utility libraries, often developed by third parties, with code that is changed much less frequently than the main piece of software being developed.&lt;/p&gt;

&lt;p&gt;But I’m not a proper computer programmer.  I’m a scientist, and like most  scientists, my code organization is a bit of a mess.  When I began this, I had one git repository, covering the folder where I kept all Matlab code that needed to be added to my Matlab path.  The purpose of that repo was simply to keep my toolboxes in sync between different computers; I initialized a single git repository in the main folder, added a remote repository on Dropbox, and then cloned the repo onto all of my computers.  With a periodic pushes and pulls to and from the Dropbox origin, I could now keep my Matlab toolboxes in sync; as a nice side effect, I also now had a log of changes.  Organization within this main folder was minimal: two subfolders, one for code that I downloaded from others, and one for code I wrote myself.  The external code folder was pretty nicely organized, maintaining the folder structure of each acquired toolbox.  The personal folder was, well, not… plotting tools, basic math and matrix manipulation, high-frequency acoustics, graph theory, food webs, climate models, biogeochemistry… The files were loosely organized into a few folders, but those folders were meaningless; file dependencies crisscrossed all over the repo.&lt;/p&gt;

&lt;p&gt;Matlab itself offers some tools to figure out the child functions called by an individual function (&lt;code class=&quot;highlighter-rouge&quot;&gt;matlab.codetools.requiredFilesAndProducts&lt;/code&gt; in R2014b… older versions offered &lt;code class=&quot;highlighter-rouge&quot;&gt;depfun&lt;/code&gt;, which was pretty buggy and unreliable, so I used a third-party function, &lt;a href=&quot;http://www.mathworks.com/matlabcentral/fileexchange/17291-fdep--a-pedestrian-function-dependencies-finder&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fdep&lt;/code&gt;&lt;/a&gt;.  What I ideally wanted, for distribution purposes, was to be able to use those lists of files to define a git repository.  But git, unfortunately, doesn’t work that way.  I looked at git submodules, but those assume that the submodule files are relatively static, not at all the case here. I definitely wanted a solution that would allow me to update any given function at any time without worrying about (or remembering) which other other files might call or be called by it.  Submodules looked like they could quickly become a nightmare.  The other potential candidate for sharing code between repositories seemed to be git subtrees, and this is where I eventually found my solution.  Getting everything set up ended up being more complicated than I anticipated, and involved a good deal of experimentation (not to mention a few dozen hard resets), but in the end, I did build a system of repos that met all my requirements:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The main repo still looks more or less the same, and maintains the benefit of my original disorganized collection: no necessity to assign any function to a single project, allowing me to constantly update functions, and use them in any bit of my research, with any function potentially using any other function at some point down the road.  I can dump any new function into these folders to add it to my Matlab path, without having to update said path manually.&lt;/li&gt;
  &lt;li&gt;If I decide to share a particular function (or functions), I can easily set up a new repository which includes that function and all the dependent functions required to properly run it.  These project-specific repos are the ones I upload to GitHub.&lt;/li&gt;
  &lt;li&gt;Going forward, as I update my code, I can quickly push the changes from the main repo to the project-specific ones without having to remember what went with what.  And the file dependencies don’t have to be static either… if I decide to change code such that a shared-out function gains a need for or no longer needs a certain other function, the function will be added to or deleted from the project repository automatically.&lt;/li&gt;
  &lt;li&gt;Going in the opposite direction, if someone decides to collaborate and send changes via a pull request on GitHub, I can merge those changes and then push them back both to my main working repo and any other project repos that use that code. (Theoretically, at least… I haven’t yet had any experience with pull requests.)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;setting-up-the-subtrees&quot;&gt;Setting up the subtrees&lt;/h3&gt;

&lt;p&gt;So… many… subtrees! 145, to be exact (at least for now).  Here’s how they came to be:&lt;/p&gt;

&lt;h4 id=&quot;step-1-organize-all-my-files-into-folders&quot;&gt;Step 1: Organize all my files into folders&lt;/h4&gt;

&lt;p&gt;I couldn’t get around the fact that git operates on folders, not files.  So my first step was to do a little bit of organization in the existing main repo.  I basically wanted to package files into folders where their foldermates were going to accompany them into any shared-out repo they might travel to.  This did &lt;strong&gt;not&lt;/strong&gt; take into consideration file dependency (I’ll deal with that later).  Many files ended up in folders by themselves; the larger groups included 5-10 files relating to very specific categories.  For example, files to read and write a specific file format ended up together… I can’t foresee a scenario where I would want to give out one and not the other, and even if a shared-out utility called just one, it wouldn’t be too annoying (it might even prove useful) for the end user if the others tagged along in the package.&lt;/p&gt;

&lt;p&gt;Here’s a quick diagram showing my basic folder structure after everything was organized&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-none&quot; data-lang=&quot;none&quot;&gt;.
├── ExternalToolboxes
│   ├── Ex1
│   ├── Ex2
│   ├── FileExchange
│   │   ├── fex1
│   │   ├── fex2
|   |   └── fex3
│   └── Ex3
├── PersonalToolboxes
│   ├── Per1
│   ├── Per2
│   ├── GeneralUtilities
│   │   ├── gu1
│   │   ├── gu2
|   |   └── gu3
│   ├── Per3
│   └── Per4&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I decided to keep all the little one- or two-function groups under the GeneralUtilities umbrella folder.  Likewise, I continued to keep all the utilities I had downloaded from the File Exchange under a single parent folder.&lt;/p&gt;

&lt;h4 id=&quot;step-2-choose-a-file-or-set-of-files-to-share&quot;&gt;Step 2: Choose a file (or set of files) to share&lt;/h4&gt;

&lt;p&gt;For this example, I’ll use one of the functions I had put on the FileExchange: contourfcmap.m.&lt;/p&gt;

&lt;h4 id=&quot;step-3-determine-the-file-dependencies-of-the-files&quot;&gt;Step 3: Determine the file dependencies of the file(s)&lt;/h4&gt;

&lt;p&gt;I figured out file and toolbox dependencies using Matlab’s built-in tools:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;table style=&quot;border-spacing: 0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot; style=&quot;text-align: right&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matlab&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;codetools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;requiredFilesAndProducts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;which&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;contourfcmap&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This particular example uses a mix of my own functions and ones I downloaded from others. It also requires a few extra toolboxes for full functionality.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;table style=&quot;border-spacing: 0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot; style=&quot;text-align: right&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-none&quot; data-lang=&quot;none&quot;&gt;ans = 

    &#39;~/Main/ExternalToolboxes/FileExchange/contourcs/contourcs.m&#39;
    &#39;~/Main/ExternalToolboxes/FileExchange/function_handle/function_handle.m&#39;
    &#39;~/Main/PersonalToolboxes/GeneralUtilities/contourfcmap/contourfcmap.m&#39;
    &#39;~/Main/PersonalToolboxes/GeneralUtilities/fillnan/fillnan.m&#39;
    &#39;~/Main/PersonalToolboxes/GeneralUtilities/multiplepolyint/multiplepolyint.m&#39;
    &#39;~/Main/PersonalToolboxes/GeneralUtilities/parsepv/parsepv.m&#39;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-matlab&quot; data-lang=&quot;matlab&quot;&gt;&lt;table style=&quot;border-spacing: 0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot; style=&quot;text-align: right&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-none&quot; data-lang=&quot;none&quot;&gt;ans = 

    &#39;MATLAB&#39;
    &#39;Image Processing Toolbox&#39;
    &#39;Mapping Toolbox&#39;
    &#39;Statistics Toolbox&#39;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;step-4-split-folders-into-subtrees&quot;&gt;Step 4: Split folders into subtrees&lt;/h4&gt;

&lt;p&gt;Starting with the first dependency in the list (contourcs), I initialized a bare repository locally:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;mkdir contourcs-repo
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;contourcs-repo 
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git init --bare&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Then I created a subtree branch including the folder where contourcs.m lived:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/Main
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git subtree split --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ExternalToolboxes/FileExchange/contourcs -b contourcs-split --squash&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Then I pushed that branch to the bare repo, setting it as the master branch:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git push ~/GitRepos/contourcs-repo contourcs-split:master&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next, I wanted to create a remote origin. I wanted my remote origins to be hosted on a server I could access from any computer (rather than sticking with my old Dropbox method). I originally focused on GitHub, since that was my intended target for the final project repos (so I could take advantage of the MatlabCentral File Exchange integration). But for this particular step, I wanted to keep the single-folder intermediary repos private. GitHub charges for this feature on a per-repository basis… seeing that I was eventually going to create over 100 repositories, that wasn’t going to work for me. Luckily, Bitbucket offers an unlimited number of private repositories, and charges on a per-person basis. With just me needing access to the private repos, this remains free. So Bitbucket won the job of hosting my intermediate repos.&lt;/p&gt;

&lt;p&gt;I initialized a new repository on Bitbucket (taking advantage of their REST API to do this from the command line), then added it as a remote repository&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/contourcs-repo
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;curl --user myusername:mypassword https://api.bitbucket.org/1.0/repositories/ --data &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;contourcs.git --data &lt;span class=&quot;nv&quot;&gt;is_private&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git remote add origin git@bitbucket.org:kakearney/contourcs.git
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git push origin master&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;At this point, the local repo (contourcs-repo) has served its purpose, and can be deleted if you want. In retrospect, I think I could probably skip that step and push directly from the subtree split branch to Bitbucket, but the example I copied to create a split subtree used the bare-repo intermediate, so I decided better safe than sorry.&lt;/p&gt;

&lt;h4 id=&quot;step-5-replace-the-folders-from-the-main-folder-with-their-subtree-equivalents&quot;&gt;Step 5: Replace the folders from the main folder with their subtree equivalents&lt;/h4&gt;

&lt;p&gt;First, I added the subtree repos as remotes to the main repo:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/Main
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git remote add contourcs-remote git@bitbucket.org:kakearney/contourcs.git&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Then I deleted the original folder and added it back as a subtree:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git rm -r ExternalToolboxes/FileExchange/contourcs
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git add -A
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git commit -m &lt;span class=&quot;s2&quot;&gt;&quot;Removing contourcs in prep for subtree&quot;&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ExternalToolboxes/FileExchange/contourcs contourcs-remote master&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I’m not sure if the delete-and-add step is strictly necessary. Pretty sure it isn’t (again, it’s something I copied from an example). But it has the nice side effect of adding a commit to my main git log documenting that a subtree addition took place. This will be very useful in later steps. The net effect, though, is no change to the file structure of the main repo.&lt;/p&gt;

&lt;h4 id=&quot;step-6-repeat-steps-4-and-5-with-all-folders-from-the-file-dependency-list&quot;&gt;Step 6: Repeat steps 4 and 5 with all folders from the file-dependency list&lt;/h4&gt;

&lt;p&gt;For this example, I repeat the process for the other 5 files in the list. I now have a collection of 6 Bitbucket repositories, one for each parent folder of the dependent files. The main repo is unchanged, except for the fact that it has gained 6 new remotes, and 6 new branches.&lt;/p&gt;

&lt;h4 id=&quot;step-7-set-up-a-new-project-repository&quot;&gt;Step 7: Set up a new project repository&lt;/h4&gt;

&lt;p&gt;Now it’s time to create the new project repository, which will be the one shared out to others. First create a new repo, adding a few empty files that will be useful down the road.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;mkdir contourfcmap-pkg
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;contourfcmap-pkg
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;touch .gitignore
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;touch README.md
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git init
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git add -A
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git commit &lt;span class=&quot;s2&quot;&gt;&quot;Initial commit&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next, add the appropriate subtree remotes, and use them to add the necessary files:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;git remote add contourcs-remote git@bitbucket.org:kakearney/contourcs.git
git remote add function_handle-remote git@bitbucket.org:kakearney/function_handle.git
git remote add contourfcmap-remote git@bitbucket.org:kakearney/contourfcmap.git
git remote add fillnan-remote git@bitbucket.org:kakearney/fillnan.git
git remote add multiplepolyint-remote git@bitbucket.org:kakearney/multiplepolyint.git
git remote add parsepv-remote git@bitbucket.org:kakearney/parsepv.git
git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;contourcs contourcs-remote master
git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;function_handle function_handle-remote master
git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;contourfcmap contourfcmap-remote master
git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;fillnan fillnan-remote master
git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;multiplepolyint multiplepolyint-remote master 
git subtree add --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;parsepv parsepv-remote master&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;All the required files will now be copied into this project folder.&lt;/p&gt;

&lt;h4 id=&quot;step-8-upload-to-github&quot;&gt;Step 8: Upload to GitHub&lt;/h4&gt;

&lt;p&gt;This repo is now ready for public view, so I added it to GitHub. I used a utility call &lt;a href=&quot;https://github.com/github/hub&quot;&gt;hub&lt;/a&gt; (available through Homebrew and MacPorts for fellow Mac users) to create the new repo from the command line; this command automatically sets the new GitHub repo as the origin.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;hub create contourfcmap-pkg -d &lt;span class=&quot;s2&quot;&gt;&quot;Create a filled contour plot in Matlab, with better color-to-value clarity&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The contourfcmap utility is now available to anyone who wants to use it, packaged together with all the files necessary to run it fully.&lt;/p&gt;

&lt;h4 id=&quot;step-9-repeat-procedure-for-all-other-sets-of-files-i-want-to-share&quot;&gt;Step 9: Repeat procedure for all other sets of files I want to share&lt;/h4&gt;

&lt;p&gt;Choose a new file (or set of files… and they don’t have to come from the same starting folder), and repeat Steps 2-8. The only change the next time through is that at the beginning of Step 4, I first use the following command to go through the main repo’s log and list the subtrees that have already been created:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/Main
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git log | grep git-subtree-dir | tr -d &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&#39;&lt;/span&gt; | cut -d &lt;span class=&quot;s2&quot;&gt;&quot;:&quot;&lt;/span&gt; -f2 | sort | uniq&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If a folder is already included in the list, I don’t have to repeat Steps 4-5 for it.&lt;/p&gt;

&lt;h4 id=&quot;step-10-remember-which-subtrees-go-where&quot;&gt;Step 10: Remember which subtrees go where&lt;/h4&gt;

&lt;p&gt;And by remember, I mean write it down! I only made it through setup for about two or three of these before I realized maintenance was going to be a pain if I didn’t keep careful track of everything. I ended up writing a Matlab script to automate all the steps listed above for the 145 packages you can find on my &lt;a href=&quot;http://kellyakearney.net/matlab-utilities/&quot;&gt;Matlab Utilities&lt;/a&gt; page. I also added a few steps to check for changes in file dependencies, and to add and delete subtree remotes as necessary when things change. At Step 4, the script writes the command necessary to push changes from the main repo to the new subtree remote to a file:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table style=&quot;border-spacing: 0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot; style=&quot;text-align: right&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Pushing subtrees from main repo to remotes&quot;&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/Main

git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/aggregate aggregate-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/aggregatehist aggregatehist-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/parsepv parsepv-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/arcasciiread arcasciiread-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/arrowpolygon arrowpolygon-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/aviread16bitcol aviread16bitcol-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/barareaneg barareaneg-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/barpatch barpatch-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/bezier bezier-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/bilread bilread-remote master
git subtree push --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PersonalToolboxes/GeneralUtilities/cellstr2 cellstr2-remote master
...etc...&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Likewise, at Step 7, it writes the corresponding commands to pull the correct files to the project-specific repos:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;table style=&quot;border-spacing: 0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot; style=&quot;text-align: right&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Updating distribution packages&quot;&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** aggregate-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/aggregate-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;aggregate aggregate-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** aggregatehist-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/aggregatehist-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;aggregate aggregate-remote master
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;aggregatehist aggregatehist-remote master
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;parsepv parsepv-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** arcasciiread-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/arcasciiread-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arcasciiread arcasciiread-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** arrowpolygon-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/arrowpolygon-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arrowpolygon arrowpolygon-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** aviread16bitcol-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/aviread16bitcol-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;aviread16bitcol aviread16bitcol-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** barareaneg-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/barareaneg-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;barareaneg barareaneg-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** barpatch-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/barpatch-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;barpatch barpatch-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** bezier-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/bezier-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bezier bezier-remote master
git push origin master

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;** bilread-pkg&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/GitRepos/bilread-pkg
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bilread bilread-remote master
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;cellstr2 cellstr2-remote master
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;parsepv parsepv-remote master
git subtree pull --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;regexpfound regexpfound-remote master
git push origin master

...etc...&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;step-11-return-to-work&quot;&gt;Step 11: Return to work&lt;/h4&gt;

&lt;p&gt;While the initial setup was a little messy, the maintenance is quite simple. I can now continue to work as I used to, largely ignoring the new project repos.&lt;/p&gt;

&lt;p&gt;My Matlab startup script hardcodes addpath commands for all the bigger utilities (listed in my file tree above as Per1, Per2, Ex1, Ex2, etc), and also adds all the folders under ExternalToolboxes/FilesExchange and PersonalToolboxes/GeneralUtilities. So I can add new tools to either of those latter folders without having to worry about updating my path.&lt;/p&gt;

&lt;p&gt;Like before, if I make any changes to my code, I update the main git repo with new commits as necessary. And every so often, I run the pushsubtrees.sh and pullsubtrees.sh scripts from Step 10, which automatically adds those changes to all the shared-out project repos.&lt;/p&gt;
</description>
        <pubDate>Mon, 02 Feb 2015 00:00:00 -0800</pubDate>
        <link>http://kellyakearney.net/2015/02/02/using-git-subtrees-to-manage-files-with-overlapping-dependencies/</link>
        <guid isPermaLink="true">http://kellyakearney.net/2015/02/02/using-git-subtrees-to-manage-files-with-overlapping-dependencies/</guid>
        
        
      </item>
    
  </channel>
</rss>
