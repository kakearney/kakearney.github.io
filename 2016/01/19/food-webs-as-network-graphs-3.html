<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Food webs as network graphs-- Part 3: The Code</title>
  <meta name="description" content="This is Part 3 in my three-part series on visualizing food webs as network graphs.  Part 1 – Part 2 – Part 3">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://kellyakearney.net/2016/01/19/food-webs-as-network-graphs-3.html">
  <link rel="alternate" type="application/rss+xml" title="Kelly A. Kearney" href="http://kellyakearney.net/feed.xml" />
<link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.2.4' type='text/css' media='all' />
<link href='http://fonts.googleapis.com/css?family=Titillium+Web:600italic,600,400,400italic' rel='stylesheet' type='text/css'>

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Kelly A. Kearney</a>


    <nav class="site-nav">

      <a href="#" class="menu-icon menu.open">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>  

    <div class="trigger"><h1>Main Navigation</h1>

 <ul class="menu">

    
    
     <li><a href="/research/" class="page-link">Research</a>
    
    </li>
    
    
     <li><a href="/blog/" class="page-link">Technical Blog</a>
    
    </li>
    
    
     <li><a href="/publications/" class="page-link">Publications</a>
    
    </li>
    
    </ul>


<!-- <ul class="menu">
        <li> <a class="page-link" href="/about">About</a></li>
        <li> <a class="page-link"  href="/blog">Blog</a>
        <li> <a class="page-link" href="/blog">CV</a>
        <li> <a class="page-link" href="/blog">For Students</a></li>
        <li> <a class="page-link"  href="/blog">Research</a></a>
        <li> <a class="page-link" href="/blog">Teaching</a>
<ul class="sub-menu">
	<li><a href="http://svmiller.com/teaching/posc-1020-introduction-to-international-relations/">POSC 1020 – Introduction to International Relations</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3410-quantitative-methods-in-political-science/">POSC 3410 – Quantitative Methods in Political Science</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3610-international-politics-in-crisis/">POSC 3610 – International Politics in Crisis</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3630-united-states-foreign-policy/">POSC 3630 – United States Foreign Policy</a></li>
</ul></li>
        <li> <a class="page-link" href="/blog">Miscellany</a>
<ul class="sub-menu">
	<li><a href="http://svmiller.com/teaching/posc-1020-introduction-to-international-relations/">Clean USAID Greenbook Data</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3410-quantitative-methods-in-political-science/">Journal of Peace Research *.bst File</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3610-international-politics-in-crisis/">My Custom Beamer Style</a></li>
</ul> 

</li>
</ul> -->

     </div>  
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Food webs as network graphs-- Part 3: The Code</h1>
    <p class="post-meta">Posted on January 19, 2016   

  in
  


</p>
  </header>

  <article class="post-content">
    <p>This is Part 3 in my three-part series on visualizing food webs as network graphs.  <br />
<a href="/2016/01/19/food-webs-as-network-graphs-1.html">Part 1</a> – <a href="/2016/01/19/food-webs-as-network-graphs-2.html">Part 2</a> – <strong>Part 3</strong></p>

<p>Update 08/24/2016: This post was written early in the development process of this tool.  Updates continue alonside manuscript preparation; the most recent code (not yet documented) can be found <a href="https://github.com/kakearney/foodwebgraph-pkg">here</a>.</p>

<h2 id="the-toolbox">The toolbox</h2>

<p>The food web diagrams seen on my Ocean Sciences 2016 poster were created using code written in Matlab and javascript.  The code collection can be downloaded <a href="https://github.com/kakearney/foodwebnetworkgraph-pkg">from GitHub</a>.  In order to run this code, you must be running Matlab R2015b or later.</p>

<p>I did originally have the goal of providing a pure javascript-plus-html version of this toolbox, making it platform independent and eliminating the need for Matlab (which I love, but is expensive).</p>

<p>Unfortunately, the edge-bundling calculations have proven too computationally-intensive for this, at least with my rather rudimentary javascript programming skills (I’ve played around with some other implementations of force-directed edge bundling in D3, such as <a href="http://bl.ocks.org/sjengle/5450007">this one</a>, and they too slowed to a painful crawl when I tested them on even small food webs).  And the resulting SVGs, with thousands of components (or hundreds of thousands, when attempting to add edge color gradients), were terrible to try to work with (crashed a couple browsers and Adobe Illustrator, though Inkscape was generally up to the task).</p>

<p>So, in the end, the majority of the code I developed for this process is written in Matlab, simply because that’s where I do most of my work.  Apologies to all the R and python people out there.</p>

<p>The following example will take you through the full process of using this code to create a food web diagram based on an Ecopath food web model.  For for information about each Matlab function, you can check the function help in the header of each file (type <code class="highlighter-rouge">help &lt;functionname&gt;</code> from the Matlab Command Window).</p>

<h2 id="the-process">The process</h2>

<h3 id="step-1-start-with-an-ecopath-model">Step 1: Start with an Ecopath model</h3>

<p>Although this graphing process can be applied to any network food web, many of the calculations (network fluxes, trophic levels, etc.) in this particular code suite are based on my Matlab implementation of the Ecopath model.  <a href="http://ecopath.org/">Ecopath with Ecosim</a> is a software suite, used primarily in fisheries modeling, which calculates a mass-balance snapshot of the biomass pools and fluxes in a food web.</p>

<p>You can import an Ecopath model into Matlab using one of two processes:</p>

<ul>
  <li><code class="highlighter-rouge">mdb2ewein.m</code>: This function reads information directly from an EwE 6 database file (.EwEmdb file).  This function relies on the <a href="https://github.com/brianb/mdbtools">mdbtools</a> utility to extract info the the Microsoft Access file format, so that needs to be installed prior to running this.</li>
  <li><code class="highlighter-rouge">rpath2ewein.m</code>: This function reads food web data from a set of Rpath .csv files.  <a href="https://github.com/slucey/RpathDev">Rpath</a> is the R implementation of Ecopath with Ecosim.  It is currently still in beta testing, so this format is loosely documented for now; it will be updated once Rpath is officially released.</li>
</ul>

<p>Alternatively, you can manually contruct the necessary input structure by following the description of the input in <code class="highlighter-rouge">ecopathlite.m</code>.</p>

<p>For our example, we’re using the direct import method, with one of the ecosystem models that ships with Ecopath with Ecosim.</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">Ewein</span> <span class="o">=</span> <span class="n">mdb2ewein</span><span class="p">(</span><span class="s1">'Generic_37.EwEmdb'</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>(Note: It turns out this was a somewhat poor choice of an example ecosystem.  The functional groups in this food web are already pretty cosolidated, so much so that the trophic grouping algorithm can settle into a few different local minima when run repeatedly.  So you may get slightly different results than I did when you run this code.)</p>

<h3 id="step-2-convert-to-a-graph-object">Step 2: Convert to a graph object</h3>

<p>The conversion is performed via the <code class="highlighter-rouge">ecopath2graph.m</code> function:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">G</span> <span class="o">=</span> <span class="n">ecopath2graph</span><span class="p">(</span><span class="n">Ewein</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="step-3-prepare-graph-object-for-trophic-grouping">Step 3: Prepare graph object for trophic grouping</h3>

<p>As discussed in the previous blog post, this involves removing out-of-system nodes and non-predatory flux edges.</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="n">G2</span> <span class="o">=</span> <span class="n">G</span><span class="p">;</span>

<span class="n">detid</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">oosid</span> <span class="o">=</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">);</span>

<span class="n">G2</span> <span class="o">=</span> <span class="n">rmnode</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">oosid</span><span class="p">);</span>
<span class="n">isdet</span> <span class="o">=</span> <span class="nb">ismember</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">Edges</span><span class="o">.</span><span class="n">EndNodes</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">detid</span><span class="p">);</span>
<span class="n">G2</span> <span class="o">=</span> <span class="n">rmedge</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="nb">find</span><span class="p">(</span><span class="n">isdet</span><span class="p">));</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>You may find you want to make some other manual changes for visualization purposes.  For example, I often limit the biomass of detrital groups, which can be much larger than the living groups, to avoid unnecessarily giant nodes in the final visualization.</p>

<h3 id="step-4-calculate-trophic-groups">Step 4: Calculate trophic groups</h3>

<p>Trophic groups can be calculated with the <code class="highlighter-rouge">gauzensgroupep.m</code> function:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">grp</span> <span class="o">=</span> <span class="n">gauzensgroupep</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">,</span> <span class="s1">'trophicgroup'</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="step-5-position-nodes">Step 5: Position nodes</h3>

<p>As discussed in the previous post, the main positioning calculations are carried out by a javascript function.  A few functions allow us to call this javascript function from within Matlab.</p>

<p>First, we need to set up input data that meets the formatting requirements of the javascript function (which uses the JSON format to list nodes and their hierarchical relationship to each other).  The second output of the <code class="highlighter-rouge">trophicgroupgraph.m</code> function matches this format:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="p">[</span><span class="n">H3</span><span class="p">,</span> <span class="n">G3</span><span class="p">]</span> <span class="o">=</span> <span class="n">trophicgroupgraph</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">grp</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>We can then pass this new graph object to the <code class="highlighter-rouge">renderfoodwebforce.m</code> function.  The <code class="highlighter-rouge">renderfoodwebforce.m</code> function is a wrapper that creates an empty webpage and then runs the <code class="highlighter-rouge">foodweblayout.js</code> script with your chosen parameters.  There are a lot of user-controllable parameters; you can use the <code class="highlighter-rouge">'test'</code> mode to see how changing those affect your food web.  Particularly for large food webs, small changes in things like padding (space around nodes), charge (repelling force between nodes), trophic nudging (speed at which nodes move toward their trophic level), scaling factor for initial node size (smaller space leads to smaller nodes with more room to move, while larger, closely-packed ones can get tangled up), and even the random seed (there’s a bit of randomness in the collison-avoidance code) can change the way the final layout looks.</p>

<p>Once you’ve settled on a good set of parameters, you’ll need to pull the coordinate information out of the html file and into Matlab.  At the moment, this step requires the use of <a href="http://phantomjs.org/">phantomJS</a>.  I’m looking for a solution that doesn’t require you to install that, but for now, it’s necessary.</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="n">opt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'drawmode'</span><span class="p">,</span> <span class="s1">'force'</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'init'</span><span class="p">,</span> <span class="s1">'cpack'</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'cpfac'</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'totheight'</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'totwidth'</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'fontsz'</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'charge'</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'padding'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'tlnudge'</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'tllim'</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span> <span class="mi">5</span><span class="p">]};</span>

<span class="c1">% Uncomment to test different parameters</span>
<span class="c1">% [hw, stat] = renderfoodwebforce(G3, 'mode', 'test', opt{:});</span>

<span class="p">[</span><span class="n">C</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">]</span> <span class="o">=</span> <span class="n">renderfoodwebforce</span><span class="p">(</span><span class="n">G3</span><span class="p">,</span> <span class="s1">'mode'</span><span class="p">,</span> <span class="s1">'extract'</span><span class="p">,</span> <span class="n">opt</span><span class="p">{:});</span>    
   <span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>In <code class="highlighter-rouge">'extract'</code> mode, this function returns data about all the circle and text objects in the resulting webpage.  To get that data into slightly more user-friendly format, run <code class="highlighter-rouge">foodweblayoutdetails</code>.  This adds a few new fields to the Nodes table of the graph object: x/y-cooridnates of the node center, radius of the node, x/y-coordinates of the text label, and horizontal and vertical alignment of the text label.</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="p">[</span><span class="n">G2</span><span class="p">,</span> <span class="n">Ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">foodweblayoutdetails</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span> <span class="mi">5</span><span class="p">]);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="step-6-run-edge-bundling">Step 6: Run edge bundling</h3>

<p>We’ll run the algorithm using the logarithmic weighting function, as discussed in Part 1 of this series:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">wlim</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="nb">log10</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">Edges</span><span class="o">.</span><span class="n">Weight</span><span class="p">),</span> <span class="s1">'expand'</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
<span class="n">wtfun</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nb">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">wlim</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">G2</span> <span class="o">=</span> <span class="n">debundle</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="s1">'edgefun'</span><span class="p">,</span> <span class="n">wtfun</span><span class="p">,</span> <span class="s1">'l'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="step-7-plot">Step 7: Plot</h3>

<p>At this point, we have all the information we need to plot the final figure in Matlab.</p>

<p>One thing to note, before creating our figure, is the conversion of units that took place under the hood of step 5 (in <code class="highlighter-rouge">foodweblayoutdetails.m</code>).  To make it easier to add a trophic level axis to the final plot, I chose to convert all positioning information from pixel space to trophic level units.  However, in order to keep all the text positioning identical to the javascript-produced figure, we need to create a new axis with the same size (in pixels) as the SVG grouping object in the webpage.  That info is stored in the <code class="highlighter-rouge">Ax</code> output structure.  So first, we set up an appropriately-sized axis, with the color of the x axis turned off (the x-axis coordinates are arbitrary, so an axis there serves no purpose):</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="n">mar</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="n">h</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="nb">figure</span><span class="p">(</span><span class="s1">'position'</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span> <span class="mi">10</span> <span class="n">Ax</span><span class="o">.</span><span class="n">dx</span><span class="o">+</span><span class="n">mar</span><span class="o">*</span><span class="mi">2</span> <span class="n">Ax</span><span class="o">.</span><span class="n">dy</span><span class="o">+</span><span class="n">mar</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="s1">'color'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">);</span>
<span class="n">h</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="nb">axes</span><span class="p">(</span><span class="s1">'units'</span><span class="p">,</span> <span class="s1">'pixels'</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'position'</span><span class="p">,</span> <span class="p">[</span><span class="n">mar</span> <span class="n">mar</span> <span class="n">Ax</span><span class="o">.</span><span class="n">dx</span> <span class="n">Ax</span><span class="o">.</span><span class="n">dy</span><span class="p">],</span> <span class="k">...</span>
            <span class="s1">'xlim'</span><span class="p">,</span> <span class="n">Ax</span><span class="o">.</span><span class="nb">xlim</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'ylim'</span><span class="p">,</span> <span class="n">Ax</span><span class="o">.</span><span class="nb">ylim</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'xcolor'</span><span class="p">,</span> <span class="s1">'none'</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Plot the edges using the <code class="highlighter-rouge">plotdeb.m</code> function:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">h</span><span class="o">.</span><span class="n">edg</span> <span class="o">=</span> <span class="n">plotdeb</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="s1">'p'</span><span class="p">,</span> <span class="mi">1</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">'rloop'</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">edg</span><span class="p">,</span> <span class="s1">'clipping'</span><span class="p">,</span> <span class="s1">'off'</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Nodes can be plotted as circular patches, using the coordinate and radius details added to the graph object in the previous step:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="n">th</span> <span class="o">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
<span class="n">h</span><span class="o">.</span><span class="n">nd</span> <span class="o">=</span> <span class="nb">arrayfun</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">r</span><span class="p">)</span> <span class="nb">patch</span><span class="p">(</span><span class="n">r</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">),</span> <span class="k">...</span>
    <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="s1">'uni'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">h</span><span class="o">.</span><span class="n">nd</span> <span class="o">=</span> <span class="nb">cat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">nd</span><span class="p">{:});</span>
<span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">nd</span><span class="p">,</span> <span class="s1">'facecolor'</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">'clipping'</span><span class="p">,</span> <span class="s1">'off'</span><span class="p">,</span> <span class="k">...</span>
    <span class="s1">'edgecolor'</span> <span class="p">,</span><span class="s1">'none'</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Text placement is also based on the details in the graph object:</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">h</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="nb">text</span><span class="p">(</span><span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">tx</span><span class="p">,</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">ty</span><span class="p">,</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="s1">'fontsize'</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">'fontname'</span><span class="p">,</span> <span class="s1">'Arial'</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span> <span class="p">{</span><span class="s1">'horizontalalignment'</span><span class="p">,</span> <span class="s1">'VerticalAlignment'</span><span class="p">},</span> <span class="p">[</span><span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">th</span> <span class="n">G2</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">tv</span><span class="p">]);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Finally, add a label to the trophic level axis, and change the colormap to a red-to-blue one.  The colormap choice is a personal preference; red-to-blue is nearly isoluminant, so it makes a good choice here (a more isoluminant red-to-green colormap is often used in figures like these, but I try to avoid that due to colorblindness issues).</p>

<figure class="highlight"><pre><code class="language-matlab" data-lang="matlab"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="nb">ylabel</span><span class="p">(</span><span class="s1">'Trophic Level'</span><span class="p">);</span>
<span class="nb">colormap</span><span class="p">(</span><span class="n">usercolormap</span><span class="p">([</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]));</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The end result:</p>

<p><img src="/assets/supporting_code/foodwebcode.png" onload="this.width/=1.5;this.onload=null;" /></p>

<p><a href="/2016/01/19/food-webs-as-network-graphs-1.html">Part 1</a> – <a href="/2016/01/19/food-webs-as-network-graphs-2.html">Part 2</a> – <strong>Part 3</strong></p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

<!--     <h2 class="footer-heading">Kelly A. Kearney</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><strong>Kelly A. Kearney</strong></li>

          <li><a href="mailto:kakearney@gmail.com">kakearney@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/kakearney">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">kakearney</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
         <p class="text">
University of Washington<br> Joint Institute for the Study of the Atmosphere and Ocean<br> Alaska Fisheries Science Center, NOAA<br> 7600 Sand Point Way N.E., Building 4<br> Seattle, Washington 98115
 
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
